var position={},currentElement=null,gameOver={},emptyPosition=[];const HAUT="HAUT",BAS="BAS",GAUCHE="GAUCHE",DROITE="DROITE",gap=15,width=107,height=107;document.addEventListener("DOMContentLoaded",function(){NewGame()},!1),window.addEventListener("keydown",function(a){-1<["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(a.code)&&a.preventDefault()},!1),window.addEventListener("keydown",logKey);var lastClicked=0;function onClickCheck(){var a=new Date().getTime();return a>lastClicked+300?(lastClicked=a,0):(lastClicked=a,-1)}function logKey(a){if(a=a||window.event,0==onClickCheck()&&0<emptyPosition.length){let b=!1;switch(a.keyCode){case 38:b=!0,moveUp();break;case 40:b=!0,moveDown();break;case 37:b=!0,moveLeft();break;case 39:b=!0,moveRight();}b&&setTimeout(()=>{generateItem(1,getEmptyPosition()),checkIfGameOver()},200)}}function NewGame(){gameOver=document.getElementsByClassName("gameOver")[0],gameOver.style.opacity=0,initPosition(),eraseGridTiles(),generateItem(1,getEmptyPosition()),generateItem(1,getEmptyPosition()),resetCompteur()}function initPosition(){position.position11={top:15,left:15,valeur:0,adjacentPosition:["position21","position12"]},position.position12={top:15,left:137,valeur:0,adjacentPosition:["position13"]},position.position13={top:15,left:259,valeur:0},position.position14={top:15,left:381,valeur:0,adjacentPosition:["position13","position24"]},position.position21={top:137,left:15,valeur:0,adjacentPosition:["position31"]},position.position22={top:137,left:137,valeur:0,adjacentPosition:["position12","position21","position23","position32"]},position.position23={top:137,left:259,valeur:0,adjacentPosition:["position24","position13"]},position.position24={top:137,left:381,valeur:0},position.position31={top:259,left:15,valeur:0},position.position32={top:259,left:137,valeur:0,adjacentPosition:["position31","position42"]},position.position33={top:259,left:259,valeur:0,adjacentPosition:["position32","position23","position43","position34"]},position.position34={top:259,left:381,valeur:0,adjacentPosition:["position24"]},position.position41={top:381,left:15,valeur:0,adjacentPosition:["position31","position42"]},position.position42={top:381,left:137,valeur:0,adjacentPosition:["position43"]},position.position43={top:381,left:259,valeur:0},position.position44={top:381,left:381,valeur:0,adjacentPosition:["position34","position43"]}}function checkIfGameOver(){let a=!0;for(const b in position)if(Object.hasOwnProperty.call(position,b)){const c=position[b];if(c.adjacentPosition!=null)for(const b of c.adjacentPosition)(position[b].valeur==c.valeur||0==position[b].valeur||0==c.valeur)&&(a=!1)}!0==a&&setTimeout(()=>{a=document.getElementsByClassName("gameOver")[0],a.style.opacity=1},600)}function eraseGridTiles(){for(let a=document.getElementsByClassName("container-grid--item");a[0];)a[0].parentNode.removeChild(a[0])}function resetCompteur(){let a=document.getElementsByClassName("container-compteur--valeur")[0],b=document.getElementsByClassName("container-meilleur--valeur")[0];a.innerHTML="0"}function generateItem(a,b){for(let c=0;c<a;c++){let a=document.createElement("div"),c=document.getElementById("grid");const d=randomInteger(0,b.length-1);a.classList.add("container-grid--item"),a.setAttribute("data-position",b[d]),a.setAttribute("data-valeur",2),a.style.top=position[b[d]].top+"px",a.style.left=position[b[d]].left+"px",a.textContent=a.getAttribute("data-valeur"),a.classList.add("value-2"),c.appendChild(a),a.classList.add("IsAppear"),setTimeout(()=>{a.classList.toggle("IsAppear")},400),position[b[d]].valeur=parseInt(a.textContent,10)}}function randomInteger(a,b){return Math.floor(Math.random()*(b-a+1))+a}function getEmptyPosition(){for(const a in emptyPosition=[],position)if(Object.hasOwnProperty.call(position,a)&&0==position[a].valeur){emptyPosition.push(a)}return emptyPosition}function moveUp(){let a=!1,b=!1,c=0,d=0;for(c=1;5>c;c++)for(a=!1,b=!1,d=1;5>d;d++){let e=0,f=0,g=0,h=0,i=0,j=0,k=!1;switch(d){case 1:break;case 2:if(e=getValueFromPosition(d-1,c),h=getValueFromPosition(d,c),0==h)break;h==e?(a=!0,k=!0,updateValuePosition(d,c,d-1,c,h),moveElement(d,c,d-1,c,k)):0==e&&(updateValuePosition(d,c,d-1,c,h),moveElement(d,c,d-1,c,k));break;case 3:if(e=getValueFromPosition(d-2,c),f=getValueFromPosition(d-1,c),i=getValueFromPosition(d,c),0==i)break;if(0==e&&0==f){updateValuePosition(d,c,d-2,c,i),moveElement(d,c,d-2,c,k);break}else if(e==i&&0==f&&!0!=a){a=!0,k=!0,updateValuePosition(d,c,d-2,c,i),moveElement(d,c,d-2,c,k);break}else if(0==f){updateValuePosition(d,c,d-1,c,i),moveElement(d,c,d-1,c,k);break}else if(f==i){b=!0,k=!0,updateValuePosition(d,c,d-1,c,i),moveElement(d,c,d-1,c,k);break}break;case 4:if(e=getValueFromPosition(d-3,c),f=getValueFromPosition(d-2,c),g=getValueFromPosition(d-1,c),j=getValueFromPosition(d,c),0==j)break;if(0==e&&0==f&&0==g){updateValuePosition(d,c,d-3,c,j),moveElement(d,c,d-3,c,k);break}else if(e==j&&0==f&&0==g&&!0!=a){a=!0,k=!0,updateValuePosition(d,c,d-3,c,j),moveElement(d,c,d-3,c,k);break}else if(0==f&&0==g){updateValuePosition(d,c,d-2,c,j),moveElement(d,c,d-2,c,k);break}else if(f==j&&0==g&&!0!=b){k=!0,b=!0,updateValuePosition(d,c,d-2,c,j),moveElement(d,c,d-2,c,k);break}else if(g==j){k=!0,updateValuePosition(d,c,d-1,c,j),moveElement(d,c,d-1,c,k);break}else if(0==g){updateValuePosition(d,c,d-1,c,j),moveElement(d,c,d-1,c,k);break}}}}function moveDown(){let a=!1,b=!1,c=0,d=0;for(c=1;5>c;c++)for(a=!1,b=!1,d=4;0<d;d--){let e=0,f=0,g=0,h=0,i=0,j=0,k=!1;switch(d){case 4:break;case 3:if(e=getValueFromPosition(d+1,c),h=getValueFromPosition(d,c),0==h)break;h==e?(a=!0,k=!0,updateValuePosition(d,c,d+1,c,h),moveElement(d,c,d+1,c,k)):0==e&&(updateValuePosition(d,c,d+1,c,h),moveElement(d,c,d+1,c,k));break;case 2:if(e=getValueFromPosition(d+2,c),f=getValueFromPosition(d+1,c),i=getValueFromPosition(d,c),0==i)break;if(0==e&&0==f){updateValuePosition(d,c,d+2,c,i),moveElement(d,c,d+2,c,k);break}else if(e==i&&0==f&&!0!=a){a=!0,k=!0,updateValuePosition(d,c,d+2,c,i),moveElement(d,c,d+2,c,k);break}else if(0==f){updateValuePosition(d,c,d+1,c,i),moveElement(d,c,d+1,c,k);break}else if(f==i){b=!0,k=!0,updateValuePosition(d,c,d+1,c,i),moveElement(d,c,d+1,c,k);break}break;case 1:if(e=getValueFromPosition(d+3,c),f=getValueFromPosition(d+2,c),g=getValueFromPosition(d+1,c),j=getValueFromPosition(d,c),0==j)break;if(0==e&&0==f&&0==g){updateValuePosition(d,c,d+3,c,j),moveElement(d,c,d+3,c,k);break}else if(e==j&&0==f&&0==g&&!0!=a){a=!0,k=!0,updateValuePosition(d,c,d+3,c,j),moveElement(d,c,d+3,c,k);break}else if(0==f&&0==g){updateValuePosition(d,c,d+2,c,j),moveElement(d,c,d+2,c,k);break}else if(f==j&&0==g&&!0!=b){k=!0,b=!0,updateValuePosition(d,c,d+2,c,j),moveElement(d,c,d+2,c,k);break}else if(g==j){k=!0,updateValuePosition(d,c,d+1,c,j),moveElement(d,c,d+1,c,k);break}else if(0==g){updateValuePosition(d,c,d+1,c,j),moveElement(d,c,d+1,c,k);break}}}}function moveLeft(){let a=!1,b=!1,c=0,d=0;for(d=1;5>d;d++)for(a=!1,b=!1,c=0;5>c;c++){let e=0,f=0,g=0,h=0,i=0,j=0,k=!1;switch(c){case 1:break;case 2:if(e=getValueFromPosition(d,c-1),h=getValueFromPosition(d,c),0==h)break;h==e?(a=!0,k=!0,updateValuePosition(d,c,d,c-1,h),moveElement(d,c,d,c-1,k)):0==e&&(updateValuePosition(d,c,d,c-1,h),moveElement(d,c,d,c-1,k));break;case 3:if(e=getValueFromPosition(d,c-2),f=getValueFromPosition(d,c-1),i=getValueFromPosition(d,c),0==i)break;if(0==e&&0==f){updateValuePosition(d,c,d,c-2,i),moveElement(d,c,d,c-2,k);break}else if(e==i&&0==f&&!0!=a){a=!0,k=!0,updateValuePosition(d,c,d,c-2,i),moveElement(d,c,d,c-2,k);break}else if(0==f){updateValuePosition(d,c,d,c-1,i),moveElement(d,c,d,c-1,k);break}else if(f==i){b=!0,k=!0,updateValuePosition(d,c,d,c-1,i),moveElement(d,c,d,c-1,k);break}break;case 4:if(e=getValueFromPosition(d,c-3),f=getValueFromPosition(d,c-2),g=getValueFromPosition(d,c-1),j=getValueFromPosition(d,c),0==j)break;if(0==e&&0==f&&0==g){updateValuePosition(d,c,d,c-3,j),moveElement(d,c,d,c-3,k);break}else if(e==j&&0==f&&0==g&&!0!=a){a=!0,k=!0,updateValuePosition(d,c,d,c-3,j),moveElement(d,c,d,c-3,k);break}else if(0==f&&0==g){updateValuePosition(d,c,d,c-2,j),moveElement(d,c,d,c-2,k);break}else if(f==j&&0==g&&!0!=b){k=!0,b=!0,updateValuePosition(d,c,d,c-2,j),moveElement(d,c,d,c-2,k);break}else if(g==j){k=!0,updateValuePosition(d,c,d,c-1,j),moveElement(d,c,d,c-1,k);break}else if(0==g){updateValuePosition(d,c,d,c-1,j),moveElement(d,c,d,c-1,k);break}}}}function moveRight(){let a=!1,b=!1,c=0,d=0;for(d=1;5>d;d++)for(a=!1,b=!1,c=4;0<c;c--){let e=0,f=0,g=0,h=0,i=0,j=0,k=!1;switch(c){case 4:break;case 3:if(e=getValueFromPosition(d,c+1),h=getValueFromPosition(d,c),0==h)break;h==e?(a=!0,k=!0,updateValuePosition(d,c,d,c+1,h),moveElement(d,c,d,c+1,k)):0==e&&(updateValuePosition(d,c,d,c+1,h),moveElement(d,c,d,c+1,k));break;case 2:if(e=getValueFromPosition(d,c+2),f=getValueFromPosition(d,c+1),i=getValueFromPosition(d,c),0==i)break;if(0==e&&0==f){updateValuePosition(d,c,d,c+2,i),moveElement(d,c,d,c+2,k);break}else if(e==i&&0==f&&!0!=a){a=!0,k=!0,updateValuePosition(d,c,d,c+2,i),moveElement(d,c,d,c+2,k);break}else if(0==f){updateValuePosition(d,c,d,c+1,i),moveElement(d,c,d,c+1,k);break}else if(f==i){b=!0,k=!0,updateValuePosition(d,c,d,c+1,i),moveElement(d,c,d,c+1,k);break}break;case 1:if(e=getValueFromPosition(d,c+3),f=getValueFromPosition(d,c+2),g=getValueFromPosition(d,c+1),j=getValueFromPosition(d,c),0==j)break;if(0==e&&0==f&&0==g){updateValuePosition(d,c,d,c+3,j),moveElement(d,c,d,c+3,k);break}else if(e==j&&0==f&&0==g&&!0!=a){a=!0,k=!0,updateValuePosition(d,c,d,c+3,j),moveElement(d,c,d,c+3,k);break}else if(0==f&&0==g){updateValuePosition(d,c,d,c+2,j),moveElement(d,c,d,c+2,k);break}else if(f==j&&0==g&&!0!=b){k=!0,b=!0,updateValuePosition(d,c,d,c+2,j),moveElement(d,c,d,c+2,k);break}else if(g==j){k=!0,updateValuePosition(d,c,d,c+1,j),moveElement(d,c,d,c+1,k);break}else if(0==g){updateValuePosition(d,c,d,c+1,j),moveElement(d,c,d,c+1,k);break}}}}function updateValuePosition(a,b,c,d,e){position[generateKeyPosition(c,d)].valeur+=e,position[generateKeyPosition(a,b)].valeur=0}function getValueFromPosition(a,b){return position[generateKeyPosition(a,b)].valeur}function getElementFromRowAndCol(a,b){let c=document.querySelector("[data-position=\"position"+a+b+"\"]");return c}function generateKeyPosition(a,b){return"position"+a+b}function getDataAttributeFromPosition(a,b){let c=document.querySelector("[data-position=\"position"+a+b+"\"]");return c.getAttribute("data-position")}function updateDataPosition(a,b,c,d,e){let f=document.querySelector("[data-position=\"position"+b+c+"\"]");return f.setAttribute("data-position","position"+d+e),f}function deleteElement(a){try{a.remove()}catch(b){console.log("l'element suivant n'a pas pu \xEAtre supprimer"),console.log(a)}}function changeDataAttribute(a,b){a.setAttribute("data-position",b)}function moveTile(a,b,c){let d=position["position"+b+c].top+"px",e=position["position"+b+c].left+"px";a.style.top=d,a.style.left=e}function toggleZindex(a){return 2==a.style.zIndex?a.style.zIndex=0:a.style.zIndex=2}function moveElement(a,b,c,d,e){let f=getElementFromRowAndCol(c,d),g=getElementFromRowAndCol(a,b);e&&(g.classList.add("effect"),g.addEventListener("animationEnd",function(){toggleZindex(g)})),moveTile(g,c,d),g.textContent=getValueFromPosition(c,d),1e3<parseInt(g.textContent)&&g.classList.add("value-max"),e&&setTimeout(()=>{deleteElement(f),g.classList.remove("effect");let a=document.getElementsByClassName("container-compteur--valeur")[0],b=document.getElementsByClassName("container-meilleur--valeur")[0];a.innerHTML=parseInt(a.innerHTML)+parseInt(g.textContent),parseInt(a.innerHTML)>=parseInt(b.innerHTML)&&(b.innerHTML=a.innerHTML),g.classList.add("value-"+g.textContent),g.classList.remove("value-"+parseInt(g.textContent/2))},300),updateDataPosition(g,a,b,c,d)}